<html>
	<head>
		<title>$$$GRAPH_TITLE$$$</title>

		<meta charset="UTF-8"> 
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1"/>

		<script src="js/cytoscape-3.21.1.min.js"></script>
        <script src="js/cytoscape-cose-bilkent.js"></script>
		<script src="js/jquery-3.0.0.min.js"></script>
		<script src="js/cytoscape-graphml-1.0.6-hier.js"></script>
		<script src="js/cytoscape-expand-collapse.js"></script>	

		<style>
			body {
				font-family: helvetica neue, helvetica, liberation sans, arial, sans-serif;
				font-size: 14px;
				background-color: white;
			}
			
			html, body, #full {
			  	height: 100%;
			}
			#full {
			  	display: flex;
			  	flex-direction: column;
			}
			#cy {
				flex-grow: 1;
				z-index: 10;
			}
			#header { 
				width: 200px; 
				position: fixed; 
				z-index: 11; 
				background-color: #e2e2e2; 
				overflow-x: hidden; 
				padding-top: 20px;
				padding-bottom: 20px;
			}
			#header b {
				padding: 6px 8px 6px 16px;
				color: #333333;
				display: block;
				cursor: pointer; 
			}
		</style>
	</head>

	<body>
		<h1>Analysis results for $$$GRAPH_TITLE$$$</h1>
		<h2>Results qualifier: $$$GRAPH_DESCRIPTION$$$</h2>
		<hr/>
		<div id="full">
			<div id="header">
				<b id="relayout">Reset layout</b> 
				<hr/>
				<b id="collapseAll">Collapse all</b> 
				<b id="expandAll">Expand all</b> 
				<b id="collapseSubNodes">Collapse sub nodes</b> 
				<b id="expandSubNodes">Expand sub nodes</b> 
				<b id="collapseDescriptions">Collapse descriptions</b> 
				<b id="expandDescriptions">Expand descriptions</b> 
				<hr/> 
				<b id="defaultView">Top-level nodes only</b>
			</div>
			<div id="cy"></div>
		</div>
		<script>			
		var api;
		var layoutOptions;
		var cy = window.cy = cytoscape({
			container: document.getElementById('cy'),
			minZoom: 0.3,
			maxZoom: 100,
			zoomingEnabled: true,
			userZoomingEnabled: true,
			style: [
				{
					selector: 'node',
					css: {
						'background-color': 'white',
						'color': 'black',
						'font-size': '12px',
						'font-weight': 'bold',
						'shape': 'rectangle',
						'border-width': '1px',
						'border-style': 'solid',
						'border-color': 'darkgray',
					}
				},
				{
					selector: 'node[NODE_TEXT]',
					css: {
						'content': 'data(NODE_TEXT)'
					}
				},
				{
					selector: 'node[LABEL_TEXT]',
					css: {
						'content': 'data(LABEL_TEXT)',
						'width': 'label',
						'text-valign': 'center',
						'border-width': '0px',
					}
				},
				{
					selector: 'node[NODE_KIND = "SUBNODE"]',
					css: {
						'background-color': 'red',
					}
				},
				{
					selector: 'node[NODE_KIND = "DESCRIPTION"]',
					css: {
						'background-color': 'green',
					}
				},	
				{
					selector: 'node[NODE_IS_ENTRY = "yes"]',
					css: {
						'border': '1px solid black',
					}
				},		
				{
					selector: 'node[NODE_IS_ENTRY = "yes"]',
					css: {
						'border-width': '5px',
						'border-style': 'solid',
						'border-color': 'black',
					}
				},	
				{
					selector: 'node[NODE_IS_EXIT = "yes"]',
					css: {
						'border-width': '5px',
						'border-style': 'double',
						'border-color': 'black',
					}
				},	
				{
					selector: 'edge',
					css: {
						'curve-style': 'bezier',
						'width': 4,
						'line-color': 'black',
						'target-arrow-shape': 'triangle',
						'target-arrow-color': 'black',
						'arrow-scale': '2'
					}
				},
				{
					selector: 'edge[EDGE_KIND = "TrueEdge"]',
					css: {
						'line-color': 'blue',
						'target-arrow-color': 'blue',
					}
				},
				{
					selector: 'edge[EDGE_KIND = "FalseEdge"]',
					css: {
						'line-color': 'red',
						'target-arrow-color': 'red',
					}
				},			
			],
			
			ready: function () {
				var data = '$$$GRAPH_CONTENT$$$'
				this.graphml({layoutBy: null});
				this.graphml(data);
				
				var expandCollapseOptions = {
					fisheye: false,
					animate: false,
					undoable: false,
					expandCollapseCuePosition: 'bottom-left',
					expandCollapseCueSize: 20,
				};				
				layoutOptions = {
					name: 'cose-bilkent',
					randomize: false,
					fit: true,
					nodeRepulsion: 200,
					gravity: 0.1,
					nodeDimensionsIncludeLabels: true,
					avoidOverlap: true,
					avoidOverlapPadding: 10,
				};	
				api = this.expandCollapse(expandCollapseOptions);
				api.setOption("layoutBy", layoutOptions);
				
				api.collapseRecursively(this.nodes('[NODE_KIND = "SUBNODE"]'), {
										layoutBy: relayout
									});
			}
		});
		
		function relayout() {
			var layout = cy.layout(layoutOptions);
			if (layout && layout.run) {
				layout.run();
			}
		}
		
		document.getElementById("relayout").addEventListener("click", function () {
			relayout();
		});
		document.getElementById("collapseAll").addEventListener("click", function () {
			api.collapseAll();
		});
		document.getElementById("expandAll").addEventListener("click", function () {
			api.expandAll();
		});
		document.getElementById("collapseSubNodes").addEventListener("click", function () {
			api.collapseRecursively(cy.nodes('[NODE_KIND = "SUBNODE"]'));
		});
		document.getElementById("expandSubNodes").addEventListener("click", function () {
			api.expandRecursively(cy.nodes('[NODE_KIND = "SUBNODE"]'));
		});
		document.getElementById("collapseDescriptions").addEventListener("click", function () {
			api.collapseRecursively(cy.nodes('[NODE_KIND = "DESCRIPTION"]'));
		});
		document.getElementById("expandDescriptions").addEventListener("click", function () {
			api.expandRecursively(cy.nodes('[NODE_KIND = "DESCRIPTION"]'));
		});
		document.getElementById("defaultView").addEventListener("click", function () {
			cy.batch(function() {
				api.expandAll();
				api.expandRecursively(cy.nodes('[NODE_KIND = "DESCRIPTION"]'));
				api.collapseRecursively(cy.nodes('[NODE_KIND = "SUBNODE"]'));
			})
		});
		</script>
	</body>
</html>
